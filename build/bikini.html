<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Bikini - The-M-Project (Absinthe)</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans" type="text/css"><link rel="shortcut icon" href="../img/Favicon.png" type="image/x-icon"></head><body class="page-docs page-secondary"><div class="navbar navbar-default"><div class="container"><div class="navbar-header"><a href="/" class="navbar-brand"><img src="/img/logo.png" class="logo"></a></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/getting-started.html"><span>Getting started</span></a></li><li><a href="/bikini.html"><span>Bikini</span></a></li><li><a href="/examples.html"><span>Examples</span></a></li><li><a href="/community.html"><span>Community</span></a></li><li><a href="http://www.the-m-project.org/docs/absinthe/" class="docu-link"><span>Documentation</span></a></li></ul></div></div></div><div class="content"><div class="headline"><div class="container"><h1 class="headline-title">Bikini</h1></div></div><aside class="headline-bottom"><div class="container"><p class="docs">Get started with The-M-Project:&nbsp;<a href="http://www.the-m-project.org/docs/absinthe/">Read The-M-Project docs &rarr;</a></p></div></aside><div class="container"><div class="row bikini"><div class="col-xs-3"><div class="sidebar-nav"><ul class="nav nav-list"></ul></div></div><div class="col-xs-9"><h1><a class="anchor" href="#data-handling-models-collections-and-stores" name="data-handling-models-collections-and-stores">Data Handling - Models, Collections and Stores</a></h1>
<p>All data handling with models and collections are based on <a href="http://backbonejs.org">backbone.js</a>, so please see their website for all the basics.</p>
<h2><a class="anchor" href="#m.model" name="m.model">M.Model</a></h2>
<p>Extends Backbone.Model for the use of an entity and store.</p>
<h3><a class="anchor" href="#extend" name="extend">Extend</a></h3>
<p><strong>M.Model.extend(properties, [classProperties]) </strong></p>
<p>A Simple example to use a specify your own id and validation (in plain Backbone syntax):</p>
<pre><code><span class="keyword">var</span> MyModel = M.Model.extend({
    idAttribute: <span class="string">'_id'</span>,        <span class="comment">// default is 'id'</span>
    baseUrl: <span class="string">'http://my.RestServer.com'</span>,
    validate: <span class="keyword">function</span>(attrs, options) {
        <span class="keyword">if</span> (!attrs.password) {
            <span class="keyword">return</span> <span class="string">"Password can not be empty"</span>;
        }
    }
});</code></pre>
<h3><a class="anchor" href="#create" name="create">Create</a></h3>
<p>In Backbone you would create a new instance of your Model like this:</p>
<pre><code><span class="keyword">var</span> model = <span class="keyword">new</span> MyModel({        
    firstname: <span class="string">'Max'</span>,
    lastname: <span class="string">'Mustermann'</span>
});</code></pre>
<p>Of course you can do this also, but you can also use create:</p>
<pre><code><span class="keyword">var</span> model = MyModel.create({
    firstname: <span class="string">'Max'</span>,
    lastname: <span class="string">'Mustermann'</span>
});</code></pre>
<h3><a class="anchor" href="#persistence" name="persistence">Persistence</a></h3>
<p>All the basics functions of manipulating and persisting Model data are also based on <a href="http://backbonejs.org/#Model">backbone.js</a>.</p>
<p>You can access model attributes using <strong>set</strong> and <strong>get</strong>, but the data will be only changed locally.</p>
<pre><code>model.set(<span class="string">'lastname'</span>, <span class="string">'Wurst'</span>); <span class="comment">// this only changes the model</span></code></pre>
<p>To <em>store</em> the data persistent, you can call <strong>save</strong>, this will create new or update changed data dependent on the existence of an id.</p>
<pre><code><span class="comment">// persist the model data</span>
model.save({ firstname: <span class="string">'Hans'</span> },    <span class="comment">// here you can change </span>
                                    <span class="comment">// attributes if needed</span>
    {
        success: <span class="keyword">function</span>(model) {
        <span class="comment">// the model data has been successfully stored</span>
    }
})</code></pre>
<p>To <em>load</em> data you can call <strong>fetch</strong> on the model, this will replace all existing data with the persisted data.</p>
<pre><code><span class="comment">// reload persisted model data  </span>
model.fetch({
    success: <span class="keyword">function</span>(model) {
        <span class="comment">// the model data has been successfully loaded</span>
    }
})</code></pre>
<h3><a class="anchor" href="#using-an-localstoragestore" name="using-an-localstoragestore">Using an LocalStorageStore</a></h3>
<p>Backbone calls Backbone.sync to persist data over a REST interface, by default M.Model / M.Collection does this nearly exact in the same way.</p>
<p>But you also have the possibility to set a custom <strong>Store</strong> to override this to override where the data should go and come from.</p>
<p>There are several stores coming with The-M-Project all based on M.Store.</p>
<p>Here is an simple example to store and load data to the local storage of the browser:</p>
<pre><code><span class="keyword">var</span> SimpleModel = M.Model.extend({
    store: M.LocalStorageStore.create(),
    entity: <span class="string">'test'</span>
});

<span class="comment">// save existing new data</span>
SimpleModel.create().save({ 
        firstname: <span class="string">'My'</span>, lastname: <span class="string">'Test'</span> 
    }, 
    success: <span class="keyword">function</span>(model) {
        <span class="comment">// model.id holds the new created id</span>
    }
});</code></pre>
<p>Please note you need to the specify an <strong>entity name</strong> to tell the store a collection / table name to store the data to.</p>
<p>Even though this works with a Model, in the most cases you will use a Collection to persist your Models in a Store.</p>
<h3><a class="anchor" href="#specifying-fields" name="specifying-fields">Specifying fields</a></h3>
<p>You can use an entity to specify foreign field names and types like this:</p>
<pre><code><span class="keyword">var</span> MyModel = M.Model.extend({
    idAttribute: <span class="string">'_id'</span>,        <span class="comment">// default is 'id'</span>
    entity: {
        name: <span class="string">'test'</span>,
        fields:  {
            _id:         { type: M.CONST.TYPE.STRING, required: YES },
            sureName:    { name: <span class="string">'USERNAME'</span>, type: M.CONST.TYPE.STRING,  required: YES },
            firstName:    { type: M.CONST.TYPE.STRING,  length: <span class="number">200</span> },
            age:        { type: M.CONST.TYPE.INTEGER }
        }
    }
});</code></pre>
<p>In this example the model will transform the attribute name &#39;sureName&#39; to &#39;USERNAME&#39; and back while saving and fetching from an REST Server or an other specified store.</p>
<h2><a class="anchor" href="#m.entity" name="m.entity">M.Entity</a></h2>
<p>The Entity is used to describe Model attributes in more detail, the specified fields are used to transform names and types to and from a store.</p>
<p>The Entity name is used by is used by the stores all models on the same place.</p>
<p>If only an Entity name is required, you can write it short hand like this:</p>
<pre><code><span class="keyword">var</span> myModel = M.Model.extend({
    entity: <span class="string">'myEntityName'</span>
})</code></pre>
<p>For a full Entity see the Model sample above.</p>
<p>If Needed you can use an Entity also by its own like this:</p>
<pre><code><span class="keyword">var</span> myEntity = M.Entity.design({  <span class="comment">// short version for extend + create</span>
        name: <span class="string">'test'</span>,
        fields:  {
            _id:     { type: M.CONST.TYPE.STRING, required: YES },
            name:    { name: <span class="string">'USERNAME'</span>, type: M.CONST.TYPE.STRING },
            age:    { type: M.CONST.TYPE.INTEGER },
            birthday: { type: M.CONST.TYPE.DATE }
        }
});</code></pre>
<p>To transform attributes you can call:    </p>
<pre><code><span class="keyword">var</span> data = myEntity.fromAttributes({
    _id: <span class="number">1000</span>,
    name: <span class="string">'Nachname'</span>,
    age: <span class="string">'33'</span>,
    birthday: <span class="string">'1999-09-23'</span>
});

console.log(data);</code></pre>
<p><code>Object {_id: &quot;1000&quot;, USERNAME: &quot;Nachname&quot;, age: 33, birthday: Moment}</code></p>
<p>The reverse way only converts the field name (&#39;USERNAME&#39; to &#39;name&#39; in this example):</p>
<pre><code>console.log(
    myEntity.toAttributes(data)
);</code></pre>
<p><code>Object {_id: &quot;1000&quot;, name: &quot;Nachname&quot;, age: 33, birthday: Moment}</code></p>
<h2><a class="anchor" href="#m.collection" name="m.collection">M.Collection</a></h2>
<p>M.Collections extends <a href="http://backbonejs.org/#Collection">Backbone.Collection</a> wich holds a set of models and is the usual way to load and save data.</p>
<h3><a class="anchor" href="#create" name="create">Create</a></h3>
<pre><code><span class="keyword">var</span> contacts = M.Collection.design({     <span class="comment">// short for extend + create</span>
    url: <span class="string">'http://nerds.mway.io:8200/bikini/contacts'</span>,    <span class="comment">// url to the entity on the rest server</span>
    model: M.Model.extend({                <span class="comment">// model prototype used for new records</span>
            idAttribute: <span class="string">'specialId'</span>    <span class="comment">// name of attribute used as id</span>
    })                                    <span class="comment">// (defaults to 'id')</span>
});</code></pre>
<h3><a class="anchor" href="#fetch" name="fetch">Fetch</a></h3>
<p>To load all data from the Server:</p>
<pre><code>contacts.fetch({
    success: <span class="keyword">function</span>(resp) {
        console.log(<span class="string">'fetched '</span> + resp.length + <span class="string">' records.'</span>);
    }, 
    error: <span class="keyword">function</span>() {
        console.log(<span class="string">'error fetching contacts.'</span>);
    }
});</code></pre>
<h3><a class="anchor" href="#get-models" name="get-models">Get Models</a></h3>
<p>Get models out of a Collection, for example a few standard Backbone methods:</p>
<pre><code><span class="keyword">var</span> firstModel = contacts.at(<span class="number">0</span>);         <span class="comment">// get the model at index 0</span>
<span class="keyword">var</span> referModel = contacts.get(<span class="string">'1234'</span>); <span class="comment">// get the model with the id '1234'</span>

<span class="comment">// iterate ofer all models</span>
contacts.each(<span class="keyword">function</span>(model){ 
    <span class="comment">// do something with the model</span>
});

<span class="comment">// return an array of all the models in a collection that match the passed attributes.</span>
<span class="keyword">var</span> favorites = friends.where({favorit: <span class="string">"X"</span>});</code></pre>
<h3><a class="anchor" href="#select-models" name="select-models">Select Models</a></h3>
<p>With M.Collection you can also use a <a href="http://docs.mongodb.org/manual/reference/operator/query/">mongoDB query</a> to select models:</p>
<pre><code><span class="keyword">var</span> specialPeople = contacts.select({
    query: { $or: [                     <span class="comment">// get all contacts where the </span>
            { firstname: <span class="regexp">/^Fr/</span> },        <span class="comment">// firstname starts with 'Fr'</span>
            { houseno: { $gte: <span class="number">23</span> } }  <span class="comment">// or the houseno is greater then 23</span>
        ]}, 
        sort: [<span class="string">'lastname'</span>]                <span class="comment">// sorted by lastname</span>
    });</code></pre>
<h3><a class="anchor" href="#create-new-model" name="create-new-model">Create new Model</a></h3>
<p>There are as always more then one way to this, you can add a new model to the collection</p>
<pre><code><span class="keyword">var</span> model = contacts.add({
    firstname: <span class="string">'New'</span>,
    lastname: <span class="string">'Model'</span>
});</code></pre>
<p>and    persist it later</p>
<pre><code>model.save();</code></pre>
<p>or create and persist the model in one call</p>
<pre><code>contacts.create({
        firstname: <span class="string">'New'</span>,
        lastname: <span class="string">'Model'</span>
    },
    success: <span class="keyword">function</span>(model) {
        <span class="comment">// here we the new created and persisted model</span>
        <span class="comment">// model.id should be set here</span>
        console.log(model.id);
    }
});</code></pre>
<h3><a class="anchor" href="#using-an-m.websqlstore" name="using-an-m.websqlstore">Using an M.WebSqlStore</a></h3>
<p>If you want to persist your data in an other way then by REST calls, you can provide a custom store.</p>
<p>In the following example the data will be loaded and stored in a WebSql Database of the browser.</p>
<pre><code><span class="keyword">var</span> webSqlStore = M.WebSqlStore.create();
<span class="keyword">var</span> people = M.Collection.design({
    store: webSqlStore,
    entity: <span class="string">'myTable'</span>
});

people.create({ FirstName: <span class="string">'Fritz'</span>, LastName: <span class="string">'Meier'</span> },
    success: <span class="keyword">function</span>(model) {
        <span class="comment">// the new created model</span>
    }
);</code></pre>
<p>In this simple constellation a table named &#39;myTable&#39; with the two columns &#39;id&#39; and &#39;data&#39; will be created, to hold an unique id and the model data as a JSON String.</p>
<p>If you want to use your own or an existing columns you can specify them in an Entity like this:</p>
<pre><code><span class="keyword">var</span> webSqlStore = M.WebSqlStore.design({
    name: <span class="string">'myDatabase'</span>,        <span class="comment">// name of the database </span>
    version: <span class="string">'1.1'</span>            <span class="comment">// the version of the db (default '1.0'</span>
});                            <span class="comment">// each change of db version will drop all tables!!</span>

<span class="keyword">var</span> person = M.Model.extend({
    idAttribute: <span class="string">'MyId'</span>,
    entity: {            
        name: <span class="string">'myTable'</span>,
        fields: {
            MyId: { type: M.CONST.TYPE.INTEGER },
            FirstName: { type: M.CONST.TYPE.STRING },
            LastName:  { type: M.CONST.TYPE.STRING }
        }
    }
});

<span class="keyword">var</span> people = M.Collection.design({
    store: webSqlStore,
    model: person
});

people.create({ <span class="comment">// attributes</span>
        FirstName: <span class="string">'Fritz'</span>, LastName: <span class="string">'Meier'</span>
    },  
    {            <span class="comment">// options</span>
        success: <span class="keyword">function</span>(model) {    
            <span class="comment">// the new created model</span>
        }
    }
);</code></pre>
<p>This will create a Database named &#39;myDatabase&#39;, the table &#39;myTable&#39; with the columns &#39;MyId&#39;, &#39;FirstName&#39; and &#39;LastName&#39;.</p>
<p>The Table will only be created if it not already exists, and only the existing columns will be filled with data.
If you need to change the schema of your data, you need to drop the table or alter it by yourself.</p>
<p>To drop the table you can change the version wich will drop all tables in the database or call</p>
<pre><code>webSqlStore.drop({
    entity: <span class="string">'myTable'</span>
});</code></pre>
<h2><a class="anchor" href="#m.bikinistore" name="m.bikinistore">M.BikiniStore</a></h2>
<p>Tataahh!! here we come to the coolest store ever ;)</p>
<p>Bikini tries to address the most common synchronization problems you have in a Mobile App, in short you get offline / online synchronization and live updates of your collection.</p>
<p>The use is quiet simple, in the easiest configuration you can use it like this:</p>
<pre><code><span class="keyword">var</span> users = M.Collection.extend({
    model: M.Model.design({ idAttribute: <span class="string">'_id'</span> }),
    url: <span class="string">'http://nerds.mway.io:8200/bikini/users'</span>,
    store: <span class="keyword">new</span> M.BikiniStore( {
        useLocalStore:   <span class="literal">true</span>, <span class="comment">// (default) store the data for offline use</span>
        useSocketNotify: <span class="literal">true</span>, <span class="comment">// (default) register at the server for live updates</span>
        useOfflineChanges: <span class="literal">true</span> <span class="comment">// (default) allow changes to the offline data</span>
    })
});</code></pre>
<p>Thats it, now you can use it like any other collection.</p>
<p>On <strong>fetch</strong> the changes or initial data will be loaded from the server but reads go always to the local data first (if useLocalStore is not set to false)</p>
<p>All <strong>create</strong> and <strong>save</strong> calls write also first to the local store and then to a log and the server if possible, if not the changes will be sent from the log when the client comes online again.</p>
<div class="end-link">Found an error in the documentation?
<a href='https://github.com/mwaylabs/the-m-project.org/issues'>File an issue</a>.</div></div></div></div></div><footer><div class="container"><div class="row"><div class="col-md-8"><div class="row link-table"><div class="col-md-3"><ul class="list-unstyled"><li><strong><a href="#">Home</a></strong></li></ul></div><div class="col-md-3"><ul class="list-unstyled"><li><strong><a href="#">About</a></strong></li><li><a href="https://github.com/mwaylabs/The-M-Project/tree/absinthe" target="_blank">Features</a></li><li><a href="http://www.the-m-project.org/docs/absinthe" target="_blank">M-Docs</a></li><li><a href="http://www.mwaysolutions.com/" target="_blank">Company</a></li><li><a href="http://www.mwaysolutions.com/en/about/imprint/" target="_blank">Imprint</a></li></ul></div><div class="col-md-3"><ul class="list-unstyled"><li><strong><a href="#">Community</a></strong></li><li><a href="http://blog.the-m-project.org/" target="_blank">Blog</a></li><li><a href="https://groups.google.com/forum/#!forum/themproject" target="_blank">Groups</a></li><li><a href="https://github.com/mwaylabs/The-M-Project/issues?labels=Absinthe&amp;state=open">GitHub Issues</a></li></ul></div><div class="col-md-3"><ul class="list-unstyled"><li><strong><a href="#">Demos</a></strong></li><li><a href="http://www.the-m-project.org/apps/absinthe/kitchensink/index.html" target="_blank">Kitchensink</a></li><li><a href="http://www.the-m-project.org/apps/absinthe/addressbook/index.html" target="_blank">Addressbook</a></li></ul></div></div></div><div class="col-md-4 text-right"><div class="social-icons text-center"><a href="https://github.com/mwaylabs/The-M-Project" target="_blank"><img src="/img/github.png" alt="GitHub"></a><a href="https://twitter.com/_themproject" target="_blank"><img src="/img/twitter.png" alt="twitter"></a><a href="http://stackoverflow.com/search?q=%22the-m-project%22" target="_blank"><img src="/img/stackoverflow.png" alt="stackoverflow"></a></div></div></div><div class="row"><div class="col-md-2"><div class="footer-logo text-center"><a href="http://www.mwaysolutions.com/" target="_blank"><img src="/img/mwaysolutions.png" alt="M-Way Solutions"></a></div></div><div class="col-md-10"><div class="copyright"><div><small>Copyright © 2011–2013 / All rights reserved by M-Way Solutions GmbH.</small></div><div><small>The M-Project framework is developed by M-Way Solutions – a leading provider of enterprise mobility software and mobile applications.</small></div></div></div></div></div></footer></body></html>